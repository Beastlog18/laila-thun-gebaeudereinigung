<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jobs – Laila Thun Gebäudereinigung</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<header class="header">
  <img src="img/Logo.png" class="header-logo" alt="Logo">

  <div class="brand-header">
    <div class="brand-line1">LAILA THUN</div>
    <div class="brand-line2">GEBÄUDEREINIGUNG</div>
    <div class="brand-divider"></div>
  </div>

  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="ueber-uns.html">Über uns</a>
    <a href="leistungen.html">Leistungen</a>
    <a href="anfrage.html">Kontakt & Angebot</a>
    <a href="jobs.html" class="active">Jobs</a>
  </nav>
</header>

<section class="section">
  <h1 class="page-title">Jobs</h1>

  <p class="page-intro">
    Wir wachsen – bewusst und Schritt für Schritt.
    Um unsere gewerblichen Kunden zuverlässig betreuen zu können,
    bauen wir unser Team weiter aus.
    <br><br>
    Wenn du zuverlässig bist, sauber arbeitest und gern im direkten Kontakt mit Menschen stehst,
    bist du bei uns richtig. Erfahrung ist hilfreich, aber kein Muss – wichtig ist,
    dass es menschlich passt.
  </p>

  <div id="jobsDynamic" class="service-grid"></div>

  <div class="service-grid mt-20">
    <div class="service-card" style="grid-column: 1 / -1;">
      <h3>Initiativbewerbung (m/w/d)</h3>

      <p class="mt-10 text-muted">
        Wir arbeiten überwiegend im <strong>südlichen Berlin</strong> sowie im <strong>Berliner Umland</strong> –
        unter anderem in <strong>Großbeeren</strong>, <strong>Wildau</strong>,
        <strong>Schulzendorf</strong> und rund um <strong>Königs Wusterhausen</strong>.
        Bei passenden Anfragen sind auch andere Regionen möglich.
      </p>

      <p class="mt-14">
        Auch wenn gerade keine konkrete Stelle ausgeschrieben ist,
        freuen wir uns jederzeit über Menschen, die zu uns passen.
        <br><br>
        Sag uns einfach kurz, wann du verfügbar bist, in welcher Region du arbeiten möchtest
        und ob du bereits Erfahrung in der Reinigung hast.
      </p>

      <ul class="about-list mt-14">
        <li>Zuverlässige Einarbeitung und feste Absprachen</li>
        <li>Persönlicher Kontakt – kein anonymer Großbetrieb</li>
        <li>Einsatzzeiten nach Absprache</li>
        <li>Langfristige Zusammenarbeit gewünscht</li>
      </ul>

      <div class="mt-16">
        <button class="btn btn-primary" type="button" data-apply="Initiativbewerbung (m/w/d)">Jetzt bewerben</button>
      </div>
    </div>
  </div>

  <div id="jobsStatus" class="mt-16 text-muted"></div>
</section>

<footer class="footer">
  © 2026 Laila Thun Gebäudereinigung – Konzept & Gestaltung: Mayk Freund<br>
  <a href="impressum.html">Impressum</a> · <a href="datenschutz.html">Datenschutz</a>
</footer>

<script src="api/supabase.client.js"></script>
<script src="api/jobs.api.js"></script>

<script>
/* --- Original JS unverändert --- */
(() => {
  "use strict";

  const elJobs = document.getElementById("jobsDynamic");
  const elStatus = document.getElementById("jobsStatus");

  function setStatus(msg) {
    if (!elStatus) return;
    elStatus.textContent = msg || "";
  }

  function escapeHtml(s) {
    return String(s ?? "")
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function splitAdminPreview(text) {
    const lines = String(text ?? "")
      .split(/\r?\n/)
      .map(l => l.trim())
      .filter(l => l.length > 0);

    const title = lines[0] || "";
    const meta = lines[1] || "";
    const body = lines.slice(2).join("\n");

    return { title, meta, body };
  }

  function highlightHeadings(body) {
    const headingSet = new Set([
      "Deine Aufgaben:",
      "Deine Aufgaben",
      "Das wünschen wir uns:",
      "Das wünschen wir uns",
      "Das bieten wir dir:",
      "Das bieten wir dir"
    ]);

    const out = [];
    const lines = String(body ?? "").split(/\r?\n/);

    for (const raw of lines) {
      const line = raw.trim();
      if (!line) {
        out.push("");
        continue;
      }

      if (headingSet.has(line)) {
        out.push("**" + line + "**");
      } else {
        out.push(line);
      }
    }

    return out.join("\n");
  }

  function toBewerbungUrl(jobTitle, jobId) {
    const params = new URLSearchParams();
    if (jobTitle) params.set("job_title", jobTitle);
    if (jobId) params.set("job_id", jobId);
    return "bewerbung.html?" + params.toString();
  }

  function renderJobs(list) {
    elJobs.innerHTML = "";

    if (!Array.isArray(list) || list.length === 0) {
      setStatus("Aktuell sind keine Stellen ausgeschrieben. Du kannst dich gern initiativ bewerben.");
      return;
    }

    setStatus("");

    for (const job of list) {
      const admin = splitAdminPreview(job.preview || "");
      const title = admin.title || job.title || "Stelle";
      let meta = admin.meta || "";
      if (!meta) {
        const type = job.type || "";
        const hours = job.hours || "";
        const location = job.location || "";
        meta = [type, hours, location].filter(Boolean).join(" · ");
      }

      const body = highlightHeadings(admin.body || "");
      const card = document.createElement("div");
      card.className = "service-card";
      const safeBody = escapeHtml(body).replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");

      card.innerHTML = `
        <h3>${escapeHtml(title)}</h3>
        ${meta ? `<p class="mt-10 text-muted">${escapeHtml(meta)}</p>` : ""}
        ${body ? `<div class="mt-14 text-muted" style="white-space: pre-wrap;">${safeBody}</div>` : ""}
        <div class="mt-16">
          <button class="btn btn-primary" type="button"
            data-apply="${escapeHtml(title)}"
            data-job-id="${escapeHtml(job.id || "")}">
            Jetzt bewerben
          </button>
        </div>
      `;

      elJobs.appendChild(card);
    }
  }

  async function loadJobs() {
    try {
      if (!window.JobsAPI || typeof window.JobsAPI.getPublishedJobs !== "function") {
        setStatus("Jobs können gerade nicht geladen werden (JobsAPI fehlt).");
        return;
      }

      setStatus("Lade Jobs …");
      const list = await window.JobsAPI.getPublishedJobs();
      renderJobs(list);
    } catch (e) {
      console.error(e);
      setStatus("Jobs konnten nicht geladen werden.");
    }
  }

  document.addEventListener("click", (ev) => {
    const btn = ev.target.closest("[data-apply]");
    if (!btn) return;

    const jobTitle = btn.getAttribute("data-apply") || "";
    const jobId = btn.getAttribute("data-job-id") || "";

    window.location.href = toBewerbungUrl(jobTitle, jobId);
  });

  loadJobs();
})();
</script>

</body>
</html>
